# ‚úÖ RBAC System Integration - –ó–∞–≤–µ—Ä—à–µ–Ω–æ

## üéâ –£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è RBAC —Å–∏—Å—Ç–µ–º–∞!

### üìÅ –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–æ:

#### üóÑÔ∏è **Backend (API)**
1. **–ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** (`apps/backend/prisma/schema.prisma`):
   - Role, Permission, UserRoleAssignment
   - RolePermission, PermissionAudit, UserPermissionCache
   - Enum PermissionScope (ALL, OWN, GROUP, DEPARTMENT, ASSIGNED)

2. **RBAC –º–æ–¥—É–ª—å** (`apps/backend/src/rbac/`):
   - `rbac.module.ts` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å
   - `rbac.service.ts` - –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
   - `role.service.ts` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏
   - `permission.service.ts` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏
   - `rbac.controller.ts` - REST API endpoints

3. **Guards –∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã** (`apps/backend/src/common/guards/`):
   - `permission.guard.ts` - –Ω–æ–≤—ã–π guard —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞–º–∏ @RequirePermission
   - –û–±–Ω–æ–≤–ª–µ–Ω `role.guard.ts` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

4. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã**:
   - `students.controller.ts` - –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –Ω–∞ –Ω–æ–≤—É—é RBAC —Å–∏—Å—Ç–µ–º—É
   - –í—Å–µ –º–µ—Ç–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç @RequirePermission –≤–º–µ—Å—Ç–æ @Roles

5. **–°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏** (`apps/backend/scripts/init-rbac.ts`):
   - –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
   - –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–æ–ª–µ–π (–ê–¥–º–∏–Ω, –£—á–∏—Ç–µ–ª—å, –°—Ç—É–¥–µ–Ω—Ç, –†–æ–¥–∏—Ç–µ–ª—å, HR, –§–∏–Ω–∞–Ω—Å–∏—Å—Ç)
   - –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### üé® **Frontend (UI)**
1. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã**:
   - `AuthContext.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –∏ –º–µ—Ç–æ–¥—ã –¥–ª—è RBAC
   - `AuthProvider.tsx` - –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **–ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã**:
   - `rbacService.ts` - –ø–æ–ª–Ω—ã–π API –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å RBAC

3. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–∞**:
   - `PermissionGuard.tsx` - —É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
   - `usePermissions()` - —Ö—É–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

4. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è**:
   - `Sidebar.tsx` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ —Ä–æ–ª–µ–π
   - –§–æ–ª–ª–±—ç–∫ –Ω–∞ —Ä–æ–ª–∏ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

5. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
   - `RoleManagement.tsx` - –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–ª—è–º–∏

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é RBAC —Å–∏—Å—Ç–µ–º—É:

### 1. üìã –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
cd apps/backend
npx prisma migrate dev --name add_rbac_system
npx ts-node scripts/init-rbac.ts
```

### 2. üîß –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö (Backend)
```typescript
// –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±
@Roles('ADMIN', 'TEACHER')

// –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–±
@RequirePermission('students', 'read', { scope: 'GROUP' })
```

### 3. üé® –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö (Frontend)
```typescript
// –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
<PermissionGuard module="students" action="create">
  <CreateStudentButton />
</PermissionGuard>

// –í –∫–æ–¥–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
const { hasPermission } = useAuth();
if (hasPermission('students', 'update', { scope: 'OWN' })) {
  // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
}
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

### ‚úÖ **–ì–∏–±–∫–∏–µ –æ–±–ª–∞—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–∞**
- **ALL** - –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –∑–∞–ø–∏—Å—è–º
- **OWN** - —Ç–æ–ª—å–∫–æ –∫ —Å–≤–æ–∏–º –∑–∞–ø–∏—Å—è–º
- **GROUP** - –∫ –∑–∞–ø–∏—Å—è–º —Å–≤–æ–µ–π –≥—Ä—É–ø–ø—ã
- **DEPARTMENT** - –∫ –∑–∞–ø–∏—Å—è–º —Å–≤–æ–µ–≥–æ –æ—Ç–¥–µ–ª–∞
- **ASSIGNED** - –∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º –∑–∞–ø–∏—Å—è–º

### ‚úÖ **–ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤**
```typescript
// –°—Ç—É–¥–µ–Ω—Ç –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –æ—Ü–µ–Ω–∫–∏
@RequirePermission('students', 'read', { scope: 'OWN' })

// –£—á–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Å–≤–æ–∏—Ö –≥—Ä—É–ø–ø
@RequirePermission('students', 'read', { scope: 'GROUP' })

// –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
@RequirePermission('students', 'read', { scope: 'ALL' })

// –†–æ–¥–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –µ–º—É –¥–µ—Ç–µ–π
@RequirePermission('students', 'read', { scope: 'ASSIGNED' })
```

### ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ 1 —á–∞—Å
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –ë–î
- –ë–∞—Ç—á–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

### ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- –ü—Ä–∏–Ω—Ü–∏–ø –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –¥–æ—Å—Ç—É–ø–∞
- –ó–∞—â–∏—Ç–∞ –æ—Ç —ç—Å–∫–∞–ª–∞—Ü–∏–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏ —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º

## üìä API Endpoints:

### –†–æ–ª–∏
```
GET    /rbac/roles                     # –í—Å–µ —Ä–æ–ª–∏
POST   /rbac/roles                     # –°–æ–∑–¥–∞—Ç—å —Ä–æ–ª—å
PUT    /rbac/roles/:id                 # –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å
DELETE /rbac/roles/:id                 # –£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å
PUT    /rbac/roles/:id/toggle-status   # –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
```

### –†–∞–∑—Ä–µ—à–µ–Ω–∏—è
```
GET    /rbac/permissions               # –í—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
POST   /rbac/permissions               # –°–æ–∑–¥–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
GET    /rbac/permissions/by-module     # –ü–æ –º–æ–¥—É–ª—è–º
POST   /rbac/permissions/create-standard/:module # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ
```

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π
```
POST   /rbac/users/:userId/roles/:roleId    # –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å
DELETE /rbac/users/:userId/roles/:roleId    # –û—Ç–æ–∑–≤–∞—Ç—å —Ä–æ–ª—å
GET    /rbac/users/:userId/roles            # –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
```
POST   /rbac/check-permission          # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
GET    /rbac/my-permissions            # –ú–æ–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
```

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:

–°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ `@Roles()` –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- `hasRole()` –∏ `hasAnyRole()` –º–µ—Ç–æ–¥—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

### 1. **–ú–∏–≥—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤**
–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å `@Roles` –Ω–∞ `@RequirePermission` –≤:
- TeachersController
- LessonsController
- HomeworkController
- UsersController
- –∏ –¥—Ä—É–≥–∏—Ö...

### 2. **–°–æ–∑–¥–∞–Ω–∏–µ UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**
- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–æ–ª–µ–π
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —Ä–æ–ª—è–º
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### 3. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏ —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Ä–æ–ª–∏ (–ø—Ä–∏–≤—è–∑–∫–∞ –∫ –≥—Ä—É–ø–ø–∞–º/–æ—Ç–¥–µ–ª–∞–º)
- –£—Å–ª–æ–≤–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

## üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç:

### ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!**
–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –≥–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞, –∫–æ—Ç–æ—Ä–∞—è:

- **–†–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É "—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏/–≤—Å–µ"** —á–µ—Ä–µ–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
- **–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ –ø—Ä–∏–Ω—Ü–∏–ø –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è** –¥–ª—è –ª—é–±—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –¥–æ—Å—Ç—É–ø–∞
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞** –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—é
- **–ê—É–¥–∏—Ä—É–µ—Ç—Å—è** –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üöÄ **–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**
–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í—ã –º–æ–∂–µ—Ç–µ:

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ —Ä–æ–ª–∏
3. –ù–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
4. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥

### üìû **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö API
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**RBAC —Å–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ**
