# Система КТП и КПИ по заполнению учебного плана

## Обзор

Была реализована комплексная система управления календарно-тематическими планами (КТП) и мониторинга КПИ по их заполнению. Система позволяет отслеживать прогресс выполнения учебных планов преподавателями и формировать рейтинги на основе полноты заполнения.

## Реализованные компоненты

### Backend (NestJS)

#### 1. Модель данных (Prisma)
```prisma
model Ktp {
  id           Int      @id @default(autoincrement())
  studyPlanId  Int
  totalHours   Int
  totalLessons Int
  sections     Json
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  studyPlan StudyPlan @relation(fields: [studyPlanId], references: [id])
  
  @@map("ktp")
}
```

#### 2. КТП Контроллер (`apps/backend/src/ktp/ktp.controller.ts`)
- `GET /ktp` - Получение списка КТП с фильтрацией и пагинацией
- `GET /ktp/:id` - Получение конкретного КТП
- `POST /ktp` - Создание нового КТП
- `PUT /ktp/:id` - Обновление КТП
- `DELETE /ktp/:id` - Удаление КТП
- `GET /ktp/statistics/overview` - Общая статистика по КТП
- `GET /ktp/kpi/completion` - КПИ по заполнению КТП
- `PUT /ktp/:ktpId/lesson/:lessonId/status` - Обновление статуса урока
- `GET /ktp/teacher/:teacherId` - КТП конкретного преподавателя
- `POST /ktp/generate/:studyPlanId` - Генерация КТП на основе учебного плана

#### 3. КТП Сервис (`apps/backend/src/ktp/ktp.service.ts`)
Основные методы:
- `findAll()` - Поиск КТП с фильтрацией
- `findOne()` - Получение КТП по ID
- `create()` - Создание КТП
- `update()` - Обновление КТП
- `getStatistics()` - Подсчет статистики
- `getCompletionKpi()` - Расчет КПИ по заполнению
- `updateLessonStatus()` - Обновление статуса урока
- `generateFromStudyPlan()` - Генерация КТП из учебного плана

#### 4. DTO классы (`apps/backend/src/ktp/dto/`)
- `CreateKtpDto` - Для создания КТП
- `UpdateKtpDto` - Для обновления КТП
- `KtpFilterDto` - Для фильтрации
- `UpdateLessonStatusDto` - Для обновления статуса урока

### Frontend (React + TypeScript)

#### 1. Типы (`apps/frontend/src/types/ktp.ts`)
```typescript
interface KtpData {
  id: number;
  studyPlanId: number;
  totalHours: number;
  totalLessons: number;
  sections: KtpSection[];
}

interface KtpSection {
  id: number;
  title: string;
  description?: string;
  totalHours: number;
  lessons: KtpLesson[];
  expanded?: boolean;
}

interface KtpLesson {
  id: number;
  title: string;
  description?: string;
  duration: number;
  week: number;
  date?: string;
  status: 'planned' | 'in_progress' | 'completed';
  materials?: string[];
  objectives: string[];
  methods: string[];
  assessment?: string;
  homework?: string;
}
```

#### 2. Сервис API (`apps/frontend/src/services/ktpService.ts`)
Основные методы:
- `getKtpList()` - Получение списка КТП
- `getKtpById()` - Получение КТП по ID
- `createKtp()` - Создание КТП
- `updateKtp()` - Обновление КТП
- `getStatistics()` - Получение статистики
- `getCompletionKpi()` - Получение КПИ данных
- `updateLessonStatus()` - Обновление статуса урока

#### 3. Компонент просмотра КТП (`apps/frontend/src/components/KtpTreeView.tsx`)
Особенности:
- Древовидная структура разделов и уроков
- Интерактивное раскрытие/скрытие разделов
- Цветовая индикация статусов уроков
- Прогресс-бары выполнения
- Модальное окно с деталями урока
- Общая статистика по курсу

#### 4. Компонент КПИ по КТП (`apps/frontend/src/components/KtpCompletionKpi.tsx`)
Функционал:
- Общая статистика по заполнению КТП
- Рейтинг преподавателей по заполнению
- Распределение по уровням выполнения
- Тренды изменения показателей
- Интеграция с существующей системой КПИ

## Структура КТП

### Разделы (Sections)
Каждый КТП состоит из разделов, которые содержат:
- Название раздела
- Описание
- Общее количество часов
- Список уроков
- Статус развернутости в интерфейсе

### Уроки (Lessons)
Каждый урок содержит:
- Название урока
- Описание
- Продолжительность в часах
- Номер недели
- Дата проведения (опционально)
- Статус: `planned`, `in_progress`, `completed`
- Учебные материалы
- Цели урока
- Методы обучения
- Способы оценивания
- Домашнее задание

## КПИ по заполнению КТП

### Метрики для преподавателей
1. **Процент заполнения КТП** - отношение заполненных уроков к общему количеству
2. **Количество КТП** - общее количество планов у преподавателя
3. **Завершенные уроки** - количество уроков со статусом "completed"
4. **Тренд** - изменение показателей за период
5. **Ранг** - позиция в общем рейтинге

### Общая статистика
- Средний процент заполнения по школе
- Количество лидеров (≥85%)
- Количество "на треке" (60-84%)
- Количество требующих внимания (<60%)
- Общее количество КТП и уроков

### Визуализация
- Карточки с ключевыми показателями
- Рейтинговая таблица преподавателей
- Прогресс-бары заполнения
- Цветовая индикация по уровням

## Интеграция с системой КПИ

Компонент КТП КПИ интегрирован в существующую страницу KPI (`apps/frontend/src/pages/KPI.tsx`), что позволяет:
- Видеть все КПИ в одном месте
- Применять общие фильтры
- Сравнивать разные типы показателей
- Экспортировать комплексные отчеты

## Адаптивность

Все компоненты адаптированы для мобильных устройств:
- Responsive grid layouts
- Мобильная навигация
- Сжатые карточки на малых экранах
- Touch-friendly интерфейс

## Безопасность

- Все API endpoint'ы защищены авторизацией
- Проверка прав доступа на уровне сервисов
- Валидация данных с помощью DTO
- Санитизация пользовательского ввода

## Развитие системы

### Планируемые улучшения
1. **Автоматическое создание КТП** из шаблонов
2. **Уведомления** о просроченных уроках
3. **Интеграция с календарем** для автоматического обновления дат
4. **Аналитика** по эффективности планирования
5. **Экспорт** КТП в различные форматы

### Возможные расширения
- Связь с системой расписания
- Интеграция с оценками студентов
- Автоматический расчет нагрузки преподавателя
- Система шаблонов для типовых уроков
- Совместное редактирование КТП

## Использование

### Для администраторов
1. Мониторинг общего прогресса заполнения КТП
2. Выявление преподавателей, требующих поддержки
3. Анализ эффективности планирования
4. Формирование отчетов для руководства

### Для преподавателей
1. Планирование учебного процесса
2. Отслеживание прогресса выполнения
3. Управление материалами и заданиями
4. Контроль соответствия учебному плану

### Для методистов
1. Контроль качества планирования
2. Анализ соответствия стандартам
3. Выявление лучших практик
4. Поддержка преподавателей в планировании

## Техническая реализация

### Используемые технологии
- **Backend**: NestJS, Prisma, PostgreSQL
- **Frontend**: React, TypeScript, Tailwind CSS
- **Графики**: Recharts
- **Иконки**: React Icons

### Производительность
- Пагинация для больших списков КТП
- Lazy loading для древовидной структуры
- Кэширование статистических данных
- Оптимизированные SQL-запросы

### Масштабируемость
- Модульная архитектура
- Разделение логики по сервисам
- Гибкая система фильтрации
- Возможность горизонтального масштабирования
