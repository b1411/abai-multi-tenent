# Как система определяет "четверть" 📅

## 🤖 Для системы четверть = это:

```typescript
case ReportPeriod.QUARTER: {
  const quarter = Math.floor(now.getMonth() / 3);
  start = new Date(now.getFullYear(), quarter * 3, 1);
  end = new Date(now.getFullYear(), quarter * 3 + 3, 0, 23, 59, 59);
  break;
}
```

### Простыми словами:
Система берет **текущий месяц**, делит на 3, и получает номер четверти:

## 📊 Календарная логика системы:

### 🌸 1-я четверть (сентябрь-ноябрь)
```
Месяцы: 8, 9, 10 (в JS месяцы с 0)
quarter = Math.floor(8 / 3) = 2
quarter = Math.floor(9 / 3) = 3  
quarter = Math.floor(10 / 3) = 3
```
**Проблема**: система считает по календарному году!

### ❄️ 2-я четверть (декабрь-февраль)
```
Месяцы: 11, 0, 1
quarter = Math.floor(11 / 3) = 3
quarter = Math.floor(0 / 3) = 0
quarter = Math.floor(1 / 3) = 0
```

### 🌱 3-я четверть (март-май)
```
Месяцы: 2, 3, 4
quarter = Math.floor(2 / 3) = 0
quarter = Math.floor(3 / 3) = 1
quarter = Math.floor(4 / 3) = 1
```

### ☀️ 4-я четверть (июнь-август)
```
Месяцы: 5, 6, 7
quarter = Math.floor(5 / 3) = 1
quarter = Math.floor(6 / 3) = 2
quarter = Math.floor(7 / 3) = 2
```

## 🚨 ПРОБЛЕМА!

**Система думает календарными кварталами:**
- Q1: Январь-Март (месяцы 0,1,2)
- Q2: Апрель-Июнь (месяцы 3,4,5)  
- Q3: Июль-Сентябрь (месяцы 6,7,8)
- Q4: Октябрь-Декабрь (месяцы 9,10,11)

**А школьные четверти:**
- 1-я: Сентябрь-Октябрь
- 2-я: Ноябрь-Декабрь  
- 3-я: Январь-Март
- 4-я: Апрель-Май

## 🔧 Правильная реализация школьных четвертей:

```typescript
private getSchoolQuarterDates(now: Date) {
  const month = now.getMonth(); // 0-11
  const year = now.getFullYear();
  
  if (month >= 8 && month <= 9) {
    // 1-я четверть: сентябрь-октябрь
    return {
      start: new Date(year, 8, 1),      // 1 сентября
      end: new Date(year, 9, 31, 23, 59, 59)  // 31 октября
    };
  } else if (month >= 10 && month <= 11) {
    // 2-я четверть: ноябрь-декабрь
    return {
      start: new Date(year, 10, 1),     // 1 ноября  
      end: new Date(year, 11, 31, 23, 59, 59) // 31 декабря
    };
  } else if (month >= 0 && month <= 2) {
    // 3-я четверть: январь-март (следующего года!)
    return {
      start: new Date(year, 0, 9),      // 9 января (после каникул)
      end: new Date(year, 2, 31, 23, 59, 59)  // 31 марта
    };
  } else if (month >= 3 && month <= 4) {
    // 4-я четверть: апрель-май
    return {
      start: new Date(year, 3, 1),      // 1 апреля
      end: new Date(year, 4, 31, 23, 59, 59)  // 31 мая
    };
  } else {
    // Летние каникулы - возвращаем предыдущую четверть
    return {
      start: new Date(year, 3, 1),      
      end: new Date(year, 4, 31, 23, 59, 59)
    };
  }
}
```

## 🎯 Текущая ситуация:

**Сегодня 1 августа 2025:**
- **Система думает**: Q3 (июль-сентябрь) 
- **На самом деле**: Летние каникулы между 4-й и 1-й четвертью

**Если бы было 15 октября:**
- **Система думает**: Q4 (октябрь-декабрь)
- **На самом деле**: 1-я четверть (сентябрь-октябрь)

## 💡 Вывод:

Для системы "четверть" = **календарный квартал**:
- Берет текущий месяц
- Делит на 3  
- Получает номер квартала (0,1,2,3)
- Строит даты начала и конца

**Но это НЕ соответствует школьным четвертям!** 

Нужно переписать `getPeriodDates()` для корректной работы с учебным годом.
