# Dashboard API Implementation

## Обзор

Реализован полнофункциональный API для дэшбордов всех типов пользователей в системе управления образовательным учреждением.

## Структура

### Файлы
- `src/dashboard/dashboard.controller.ts` - Контроллер с endpoints для каждого типа пользователя
- `src/dashboard/dashboard.service.ts` - Сервис с бизнес-логикой и запросами к БД
- `src/dashboard/dashboard.module.ts` - Модуль NestJS

### Endpoints

#### Student Dashboard
- **GET** `/dashboard/student`
- **Роль:** STUDENT
- **Данные:**
  - Предстоящие уроки (из расписания)
  - Незавершенные домашние задания
  - Средний балл (рассчитывается из оценок за уроки)
  - Посещаемость (процент присутствия на уроках)
  - Расписание на сегодня
  - Оценки по предметам с описанием

#### Teacher Dashboard
- **GET** `/dashboard/teacher`
- **Роль:** TEACHER
- **Данные:**
  - Уроки на сегодня
  - Общее количество студентов
  - Работы на проверку (mock data)
  - Предстоящие дедлайны (mock data)
  - Проведенные уроки
  - Месячная нагрузка
  - Расписание на сегодня
  - Уведомления/алерты
  - Успеваемость групп

#### Admin Dashboard
- **GET** `/dashboard/admin`
- **Роль:** ADMIN
- **Данные:**
  - Общая статистика (студенты, преподаватели, группы)
  - Месячная выручка (из платежей)
  - Заявки на рассмотрение (заявления на отпуск)
  - Системные уведомления (непрочитанные)
  - Активные аудитории
  - Показатель завершенности (процент посещенных уроков)
  - Финансовая сводка
  - Последние события (новые пользователи)

#### Parent Dashboard
- **GET** `/dashboard/parent`
- **Роль:** PARENT
- **Данные:**
  - Информация о детях (оценки, посещаемость)
  - Общие платежи
  - Просроченные платежи
  - Непрочитанные сообщения (mock data)
  - Платежи по статусам
  - Уведомления

#### Financist Dashboard
- **GET** `/dashboard/financist`
- **Роль:** FINANCIST
- **Данные:**
  - Общая и месячная выручка (из платежей)
  - Расходы (из бюджетных статей)
  - Прибыль
  - Задолженности и просроченные платежи
  - Заявки на бюджет (заявки на закупки)
  - Рост доходов/расходов (mock data)
  - Структура доходов по типам услуг
  - Структура расходов по категориям
  - Последние транзакции
  - Бюджетные заявки

#### HR Dashboard
- **GET** `/dashboard/hr`
- **Роль:** HR
- **Данные:**
  - Общее количество сотрудников
  - Активные преподаватели
  - Сотрудники в отпуске/на больничном
  - Заявления на отпуск (ожидающие рассмотрения)
  - Средняя зарплата (из данных о зарплатах)
  - Статистика сотрудников по статусам
  - Заявки на работу (mock data)
  - Заявления на отпуск
  - Аналитика по департаментам (по ролям)
  - Предстоящие события

## Использование реальных данных

### Что берется из БД:
- **Студенты:** оценки, посещаемость, домашние задания, расписание
- **Преподаватели:** расписание, студенты, группы, успеваемость
- **Администраторы:** статистика пользователей, финансы, уведомления
- **Родители:** данные детей, платежи, оценки, посещаемость
- **Финансисты:** платежи, бюджетные статьи, заявки на закупки
- **HR:** сотрудники, отпуска, зарплаты, аналитика по ролям

### Mock данные (требуют доработки БД):
- Дни рождения сотрудников (нужно поле birthDate в User)
- Заявки на работу (нужна отдельная модель JobApplication)
- Календарные события (есть модель, но не интегрировано)
- Рост доходов/расходов (нужны исторические данные)

## Безопасность

- Все endpoints защищены аутентификацией (AuthGuard)
- Роли проверяются через RolesGuard
- Каждый endpoint доступен только соответствующей роли

## Примеры использования

```typescript
// Frontend
import { dashboardService } from './services/dashboardService';

// Получить данные студенческого дэшборда
const studentData = await dashboardService.getStudentDashboard();

// Получить данные преподавательского дэшборда
const teacherData = await dashboardService.getTeacherDashboard();
```

## Структура ответов

Каждый дэшборд возвращает специфичную для роли структуру данных с:
- Ключевыми метриками в числовом виде
- Списками актуальных данных
- Аналитической информацией
- Уведомлениями и алертами

## Будущие улучшения

1. **Кэширование:** Добавить Redis для кэширования тяжелых запросов
2. **Пагинация:** Для списков с большим количеством элементов
3. **Фильтрация:** Возможность фильтровать данные по периодам
4. **Реальное время:** WebSocket для обновления данных в реальном времени
5. **Персонализация:** Возможность настройки виджетов дэшборда
