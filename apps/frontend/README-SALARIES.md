# Система управления заработной платой

## Описание

Модуль управления заработной платой предоставляет полный функционал для расчета, учета и выплаты зарплат сотрудникам образовательного учреждения.

## Основные функции

### 1. Управление зарплатами
- ✅ Создание и редактирование записей о зарплате
- ✅ Расчет базовой зарплаты, премий и удержаний
- ✅ Автоматический расчет итоговых сумм (брутто/нетто)
- ✅ Управление статусами зарплат (черновик, утверждено, выплачено)

### 2. Бонусы и премии
- ✅ Различные типы бонусов (за результативность, достижения, переработки, праздничные)
- ✅ Настраиваемые комментарии к бонусам
- ✅ Автоматический пересчет при изменении бонусов

### 3. Удержания
- ✅ Налоговые удержания
- ✅ Социальные взносы
- ✅ Прочие удержания с комментариями

### 4. Аналитика и отчетность
- ✅ Общий фонд оплаты труда
- ✅ Средняя зарплата по учреждению
- ✅ Статистика по отделам
- ✅ Динамика изменения ФОТ
- ✅ Анализ распределения зарплат

### 5. Фильтрация и поиск
- ✅ Фильтрация по статусу зарплаты
- ✅ Фильтрация по периоду (месяц/год)
- ✅ Фильтрация по отделам
- ✅ Поиск по сотрудникам

## Структура файлов

```
apps/
├── backend/src/salaries/
│   ├── salaries.module.ts          # Модуль зарплат
│   ├── salaries.controller.ts      # API контроллер
│   ├── salaries.service.ts         # Бизнес-логика
│   └── dto/
│       ├── create-salary.dto.ts    # DTO для создания
│       ├── update-salary.dto.ts    # DTO для обновления
│       └── salary-filter.dto.ts    # DTO для фильтрации
└── frontend/src/
    ├── types/salary.ts             # TypeScript типы
    ├── services/salaryService.ts   # API сервис
    └── pages/Salaries.tsx          # Главная страница
```

## API Endpoints

### Основные операции
- `GET /salaries` - Получить список зарплат с фильтрацией
- `GET /salaries/:id` - Получить зарплату по ID
- `POST /salaries` - Создать новую зарплату
- `PATCH /salaries/:id` - Обновить зарплату
- `DELETE /salaries/:id` - Удалить зарплату

### Управление статусами
- `POST /salaries/:id/approve` - Утвердить зарплату
- `POST /salaries/:id/mark-paid` - Отметить как выплаченную

### Аналитика
- `GET /salaries/statistics` - Получить статистику по зарплатам

## Модель данных

### Salary (Зарплата)
```typescript
interface Salary {
  id: number;
  teacherId: number;
  teacher: Teacher;
  baseSalary: number;          // Базовая зарплата
  bonuses: SalaryBonus[];      // Премии
  deductions: SalaryDeduction[]; // Удержания
  totalGross: number;          // Общая сумма до вычетов
  totalNet: number;            // Сумма к выплате
  month: number;               // Месяц (1-12)
  year: number;                // Год
  status: SalaryStatus;        // Статус
  approvedBy?: number;         // Кем утверждено
  approvedAt?: Date;           // Дата утверждения
  paidAt?: Date;               // Дата выплаты
  comment?: string;            // Комментарий
  createdAt: Date;
  updatedAt: Date;
}
```

### SalaryBonus (Премия)
```typescript
interface SalaryBonus {
  id: number;
  type: BonusType;            // Тип премии
  name: string;               // Название
  amount: number;             // Сумма
  comment?: string;           // Комментарий
}
```

### SalaryDeduction (Удержание)
```typescript
interface SalaryDeduction {
  id: number;
  name: string;               // Название удержания
  amount: number;             // Сумма
  comment?: string;           // Комментарий
}
```

## Статусы зарплаты

- **DRAFT** - Черновик (можно редактировать)
- **APPROVED** - Утверждено (готово к выплате)
- **PAID** - Выплачено
- **CANCELLED** - Отменено

## Типы премий

- **PERFORMANCE** - За результативность
- **ACHIEVEMENT** - За достижения
- **OVERTIME** - За переработки
- **HOLIDAY** - Праздничные
- **OTHER** - Прочие

## Особенности реализации

### Автоматические расчеты
Система автоматически пересчитывает:
- Общую сумму (базовая зарплата + все премии)
- Сумму к выплате (общая сумма - все удержания)

### Валидация
- Проверка уникальности зарплаты по учителю, месяцу и году
- Валидация сумм (не могут быть отрицательными)
- Проверка корректности периода

### Безопасность
- Разграничение доступа по ролям
- Только ADMIN, HR и FINANCIST могут управлять зарплатами
- Учителя могут только просматривать свои зарплаты

## Использование

### Создание зарплаты
```typescript
const salaryData = {
  teacherId: 1,
  baseSalary: 280000,
  month: 11,
  year: 2024,
  bonuses: [
    {
      type: 'PERFORMANCE',
      name: 'Премия за успеваемость',
      amount: 42000,
      comment: 'Отличные результаты учеников'
    }
  ],
  deductions: [
    {
      name: 'Подоходный налог',
      amount: 32000
    }
  ]
};

const salary = await salaryService.createSalary(salaryData);
```

### Получение статистики
```typescript
const stats = await salaryService.getSalaryStatistics(2024, 11);
console.log(stats.totalPayroll); // Общий ФОТ
console.log(stats.avgSalary);    // Средняя зарплата
```

## Интеграции

### С системой учета рабочего времени
- Автоматический расчет премий за переработки
- Учет больничных и отпусков

### С HR системой
- Синхронизация данных о сотрудниках
- Интеграция с системой отпусков

### С финансовой системой
- Экспорт данных для бухгалтерии
- Интеграция с банковскими системами для выплат

## Планы развития

- [ ] Шаблоны зарплат для автоматического расчета
- [ ] Интеграция с системой электронных подписей
- [ ] Мобильное приложение для сотрудников
- [ ] Расширенная аналитика и прогнозирование
- [ ] Интеграция с государственными системами отчетности
