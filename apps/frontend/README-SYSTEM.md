# Модуль "Система"

Модуль системного администрирования и настроек приложения.

## Структура модуля

### Типы данных
- `apps/frontend/src/types/system.ts` - Типы для системных сущностей

### Сервисы
- `apps/frontend/src/services/systemService.ts` - API сервис для работы с системой

### Хуки
- `apps/frontend/src/hooks/useSystem.ts` - Хуки для управления системными данными:
  - `useSystemSettings` - Системные настройки
  - `useUsers` - Управление пользователями
  - `useRoles` - Управление ролями и правами
  - `useBranding` - Настройки брендинга
  - `useIntegrations` - Управление интеграциями

### Страницы
- `apps/frontend/src/pages/SystemSettings.tsx` - Системные настройки
- `apps/frontend/src/pages/Users.tsx` - Управление пользователями
- `apps/frontend/src/pages/Permissions.tsx` - Управление правами доступа
- `apps/frontend/src/pages/Branding.tsx` - Настройки брендинга
- `apps/frontend/src/pages/Integrations.tsx` - Интеграции

## Основные возможности

### 1. Системные настройки (SystemSettings)

**Функциональность:**
- Общие настройки системы (таймзона, язык, формат даты)
- Настройки почты (SMTP сервер, порт, шифрование)
- Настройки уведомлений (push, email)
- Настройки безопасности (тайм-аут сессии)
- Обслуживание (режим обслуживания, отладка, резервные копии)

**Особенности:**
- Табированный интерфейс для разных категорий настроек
- Автосохранение изменений
- Скачивание резервных копий
- Валидация настроек

### 2. Управление пользователями (Users)

**Функциональность:**
- Просмотр списка пользователей
- Создание новых пользователей
- Редактирование профилей пользователей
- Управление статусом (активный/неактивный)
- Сброс паролей
- Фильтрация по ролям и статусу
- Поиск по имени, email, роли

**Особенности:**
- Таблица с полной информацией о пользователях
- Модальное окно для создания/редактирования
- Подтверждение удаления пользователей
- Отображение последнего входа
- Безопасный ввод паролей

### 3. Управление правами доступа (Permissions)

**Функциональность:**
- Создание и редактирование ролей
- Назначение прав доступа ролям
- Просмотр доступных разрешений по модулям
- Визуализация прав доступа
- Удаление ролей

**Особенности:**
- Двухпанельный интерфейс (роли + детали)
- Группировка разрешений по модулям
- Интерактивный выбор прав доступа
- Индикаторы активных разрешений
- Поиск по ролям

### 4. Настройки брендинга (Branding)

**Функциональность:**
- Изменение названия школы
- Загрузка логотипа и favicon
- Настройка цветовой схемы (основной, вторичный, акцентный цвета)
- Выбор шрифта
- Предпросмотр изменений в реальном времени

**Особенности:**
- Drag & drop загрузка файлов
- Color picker для выбора цветов
- Живой предпросмотр изменений
- Поддержка различных форматов изображений
- Рекомендации по размерам

### 5. Интеграции (Integrations)

**Функциональность:**
- Добавление новых интеграций
- Настройка API ключей и webhook'ов
- Подключение/отключение интеграций
- Синхронизация данных
- Мониторинг статуса интеграций

**Особенности:**
- Карточный интерфейс для интеграций
- Статусы подключения (подключено/отключено)
- Отображение времени последней синхронизации
- Настройки автосинхронизации
- Уведомления об ошибках

## API Endpoints

### Системные настройки
- `GET /system/settings` - Получить настройки
- `PUT /system/settings` - Обновить настройки
- `GET /system/backup` - Скачать резервную копию

### Пользователи
- `GET /system/users` - Список пользователей
- `POST /system/users` - Создать пользователя
- `PUT /system/users/:id` - Обновить пользователя
- `DELETE /system/users/:id` - Удалить пользователя
- `POST /system/users/:id/reset-password` - Сбросить пароль

### Роли и разрешения
- `GET /system/roles` - Список ролей
- `POST /system/roles` - Создать роль
- `PUT /system/roles/:id` - Обновить роль
- `DELETE /system/roles/:id` - Удалить роль
- `GET /system/permissions` - Доступные разрешения

### Брендинг
- `GET /system/branding` - Получить настройки брендинга
- `PUT /system/branding` - Обновить настройки брендинга
- `POST /system/branding/logo` - Загрузить логотип
- `POST /system/branding/favicon` - Загрузить favicon

### Интеграции
- `GET /system/integrations` - Список интеграций
- `POST /system/integrations` - Создать интеграцию
- `PUT /system/integrations/:id` - Обновить интеграцию
- `DELETE /system/integrations/:id` - Удалить интеграцию
- `POST /system/integrations/:id/connect` - Подключить интеграцию
- `POST /system/integrations/:id/disconnect` - Отключить интеграцию
- `POST /system/integrations/:id/sync` - Синхронизировать интеграцию

## Использование

### Базовое использование хуков

```typescript
import { useSystemSettings, useUsers, useRoles } from '../hooks/useSystem';

// Системные настройки
const { settings, updateSettings, downloadBackup } = useSystemSettings();

// Пользователи
const { users, createUser, updateUser, deleteUser } = useUsers();

// Роли
const { roles, permissions, createRole, updateRole } = useRoles();
```

### Создание пользователя

```typescript
const { createUser } = useUsers();

const handleCreateUser = async () => {
  try {
    await createUser({
      name: 'Иван Петров',
      email: 'ivan@school.edu',
      password: 'password123',
      role: 'teacher',
      department: 'Математика'
    });
  } catch (error) {
    console.error('Ошибка создания пользователя:', error);
  }
};
```

### Обновление настроек брендинга

```typescript
const { updateSettings, uploadLogo } = useBranding();

const handleLogoUpload = async (file: File) => {
  try {
    const logoUrl = await uploadLogo(file);
    await updateSettings({ logo: logoUrl });
  } catch (error) {
    console.error('Ошибка загрузки логотипа:', error);
  }
};
```

## Безопасность

### Права доступа
- Доступ к системным настройкам только для администраторов
- Управление пользователями требует соответствующих прав
- Настройки брендинга доступны администраторам и модераторам
- Интеграции могут настраивать только администраторы

### Валидация данных
- Валидация email адресов
- Проверка сложности паролей
- Ограничения на размер загружаемых файлов
- Валидация URL для webhook'ов

### Аудит
- Логирование всех изменений системных настроек
- Отслеживание создания/удаления пользователей
- Мониторинг активности интеграций

## Обработка ошибок

Все компоненты модуля включают обработку ошибок:
- Отображение сообщений об ошибках через Alert компонент
- Fallback состояния при ошибках загрузки
- Повторные попытки для критических операций
- Валидация форм на клиентской стороне

## Адаптивность

Все страницы модуля адаптированы для различных размеров экрана:
- Мобильная версия с упрощенным интерфейсом
- Планшетная версия с компактными элементами
- Десктопная версия с полным функционалом

## Производительность

Оптимизации модуля:
- Ленивая загрузка страниц
- Кэширование системных настроек
- Оптимизация загрузки изображений
- Дебаунсинг поиска пользователей
