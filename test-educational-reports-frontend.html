<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест Educational Reports API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .loading { background-color: #d1ecf1; border-color: #bee5eb; }
        pre { white-space: pre-wrap; word-wrap: break-word; max-height: 300px; overflow-y: auto; }
        button { margin: 5px; padding: 10px 15px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Тест Educational Reports API</h1>
    
    <div>
        <button onclick="setToken()">1. Установить токен</button>
        <button onclick="testStudents()">2. Получить студентов</button>
        <button onclick="testQualityStats()">3. Получить статистику</button>
        <button onclick="testSubjects()">4. Получить предметы</button>
        <button onclick="testClasses()">5. Получить классы</button>
        <button onclick="clearResults()">Очистить результаты</button>
    </div>

    <div id="results"></div>

    <script>
        const API_BASE = 'http://localhost:8000';
        const TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwiZW1haWwiOiJhZG1pbkBhYmFpLmVkdS5reiIsIm5hbWUiOiLQkNC00LzQuNC9Iiwicm9sZSI6IkFETUlOIiwiaWF0IjoxNzUzNzk5MDEyLCJleHAiOjE3NTYzOTEwMTJ9.MsThdPliVF3rwRul22hWey1BKagxOedSEwpzv4AZ0go';

        function addResult(title, content, type = 'success') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `
                <h3>${title}</h3>
                <pre>${typeof content === 'object' ? JSON.stringify(content, null, 2) : content}</pre>
            `;
            resultsDiv.appendChild(resultDiv);
        }

        function addLoading(title) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result loading';
            resultDiv.id = `loading-${Date.now()}`;
            resultDiv.innerHTML = `<h3>${title}</h3><p>Загрузка...</p>`;
            resultsDiv.appendChild(resultDiv);
            return resultDiv.id;
        }

        function removeLoading(id) {
            const element = document.getElementById(id);
            if (element) {
                element.remove();
            }
        }

        async function apiCall(url, options = {}) {
            const response = await fetch(`${API_BASE}${url}`, {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${TOKEN}`,
                    ...options.headers
                },
                ...options
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            return await response.json();
        }

        function setToken() {
            localStorage.setItem('token', TOKEN);
            addResult('Токен установлен', 'Токен сохранен в localStorage');
        }

        async function testStudents() {
            const loadingId = addLoading('Получение студентов');
            try {
                const students = await apiCall('/educational-reports/students?period=quarter&className=10А');
                removeLoading(loadingId);
                addResult('Студенты (10А, четверть)', students);
            } catch (error) {
                removeLoading(loadingId);
                addResult('Ошибка получения студентов', error.message, 'error');
            }
        }

        async function testQualityStats() {
            const loadingId = addLoading('Получение статистики качества');
            try {
                const stats = await apiCall('/educational-reports/quality-statistics?period=quarter&className=10А');
                removeLoading(loadingId);
                addResult('Статистика качества (10А, четверть)', stats);
            } catch (error) {
                removeLoading(loadingId);
                addResult('Ошибка получения статистики', error.message, 'error');
            }
        }

        async function testSubjects() {
            const loadingId = addLoading('Получение предметов');
            try {
                const subjects = await apiCall('/educational-reports/subjects');
                removeLoading(loadingId);
                addResult('Предметы', subjects);
            } catch (error) {
                removeLoading(loadingId);
                addResult('Ошибка получения предметов', error.message, 'error');
            }
        }

        async function testClasses() {
            const loadingId = addLoading('Получение классов');
            try {
                const classes = await apiCall('/educational-reports/classes');
                removeLoading(loadingId);
                addResult('Классы', classes);
            } catch (error) {
                removeLoading(loadingId);
                addResult('Ошибка получения классов', error.message, 'error');
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // Автоматически установить токен при загрузке
        window.addEventListener('load', () => {
            setToken();
        });
    </script>
</body>
</html>
